<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="../assets/css/xua-documentation.css" rel="stylesheet" type="text/css" />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         processEscapes: true
        }
      });
    </script>

    <title>Entities; - XUA Documentation</title>
</head>

<body>

    <div id="page">

        <div id="header">
            <div class='booktitleinheader'><a href='../index.html'>XUA Documentation</a></div>
            <ul id='menu'>
                <li class='menu-item'><a href='../docs/index.html'>Table of Contents</a></li>
                <li class='menu-item'><a href='../docs/CheatSheet.html'>Cheat Sheet</a></li>
                <li class='menu-item'><a href='../docs/Architecture.html'>Architecture</a></li>
            </ul>
        </div>

        <div id="main">

            <h1 class="libtitle">
                Entities;
                <span class="subtitle">The Beating Heart</span>
            </h1>

            <div class = 'comment'><a href='#Introduction'><h1 class='h1' id='Introduction'> Introduction</h1></a>
XUA can be configured to communicate with a database server (usually MySQL), but the programmer needs to specify the database structure. To do so, XUA offers Entity Blocks. Read <a href='Units.html#Entities'>Entities</a> section under <a href='Units.html'>Units</a> chapter for theoretical explanations. In this chapter, we focus on practical details of defining and using entities.</div><div class = 'comment'><a href='#Effects_on_the_projects'><h2 class='h2' id='Effects_on_the_projects'> Effects on the projects</h2></a>
XUA will generate a PHP class extending a XUA abstract class called <code>\XUA\Entity</code> for each Entity Block the programmer creates. these Entity classes are in a one-to-one relationship with database tables. Each row of the table then, can be corresponded by an instance of the table’s corresponding class.</div><div class = 'comment'>Also the same happens in the marshal library with respect to the language. But the front-end clone of the entities only contains method signatures, and the bodies are just network calls.</div><div class = 'comment'><a href='#Terminology'><h2 class='h2' id='Terminology'> Terminology</h2></a></div><div class = 'comment'><a href='#Server_Project_Side'><h3 class='h3' id='Server_Project_Side'> Server Project Side</h3></a>
A <strong>field</strong> $(T, D)$ is a tuple of a type (described in <a href='Supers.html'>Supers</a> chapter) called <strong>field type</strong> and a value called <strong>field default value</strong>.</div><div class = 'comment'>An <strong>entity signature</strong> is a set of labeled fields $F$ such that $F(s) = (T_s,
D_s)$ or $F(s)$ is undefined, where $s$ is a <strong>field name</strong>. Domain of $F$ is called set of filed names of the entity signature.</div><div class = 'comment'>An <strong>index</strong> is a $k$-tuple of field names with an extra boolean determining if the index is <strong>unique</strong>. Indexes are used in MySQL engine for faster <code>select</code> queries. We try to have a simple explanations here. Assume fields $(u, f_0, \dots,
f_n)$ are marked as index
$i_0$.
The MySQL engine will create a list of pointers to data rows, sorted by the mentioned field, which makes it faster to search on those fields. Also if the index is marked as unique, i.e., $u = 1$, the combination of fields must be unique in data, i.e., we cannot have two rows with same value of $f_0$,
same value of $f_1$,
..., and
same value of $f_n$.</div><div class = 'comment'>An <strong>entity indexes</strong> is a set of labeled indexes $I$ such that $I(s) = (u, f_{s0}, \dots
f_{sn})$ or $I(s)$ is undefined, where $s$ is a <strong>index name</strong>. Domain of $I$ is called set of index names of the entity signature.</div><div class = 'comment'>An <strong>entity validation</strong> is a function with no output, that inputs a data row and checks if the data is valid. In case of invalid data, an exception is thrown. For example assume we store data about some events, each event has two fields <code>start_time</code> and
<code>end_time</code>, and the start must be sooner than end. The entity validation checks if this condition holds, and if end is sooner than start, it will throw an exception.</div><div class = 'comment'>An <strong>entity class</strong> is a triplet $(F, I, V)$ of fields, indexes, and validation function.</div><div class = 'comment'>An <strong>entity instance</strong> is an instance of an entity class, which contains actual values for entity fields.</div><div class = 'comment'><a href='#MySQL_Side'><h3 class='h3' id='MySQL_Side'> MySQL Side</h3></a>
A <strong>database</strong> is a set of <strong>table</strong>s, each table has a <strong>structure</strong> consisting of <strong>column</strong>s, and a set of <strong>row</strong>s as <strong>data</strong>.</div><div class = 'comment'><strong>insert</strong> is action of adding new rows to a table.</div><div class = 'comment'><strong>select</strong> is action of retrieving rows from a table on some specific conditions.</div><div class = 'comment'><strong>update</strong> is action of modifying some rows of a table on some specific conditions.</div><div class = 'comment'><strong>delete</strong> is action of removing some rows of a table on some specific conditions.</div><div class = 'comment'><a href='#Correspondence'><h3 class='h3' id='Correspondence'> Correspondence</h3></a>
Each <strong>table</strong> is in one-to-one correspondence with an <strong>entity class</strong>. Methods of these classes are able to communicate with database server to select, insert, update, and delete data. <strong>Field</strong>s of the entity class represent the <strong>column</strong>s of the table, and <strong>instance</strong>s of the class represent the <strong>row</strong>s of the table.</div><div class = 'comment'></div><div class = 'comment'><a href='#Definition'><h1 class='h1' id='Definition'> Definition</h1></a></div><div class = 'comment'><a href='#Structure'><h2 class='h2' id='Structure'> Structure</h2></a>
An entity block has the following structure.</div><pre><code>#&nbsp;Path\To\Entity\EntityName<br>&nbsp;<br>#&nbsp;Description&nbsp;of&nbsp;what&nbsp;this&nbsp;Entity&nbsp;is&nbsp;all&nbsp;about,&nbsp;probably&nbsp;in&nbsp;markdown&nbsp;formatting.<br>#&nbsp;etc.<br>&nbsp;<br>Entity&nbsp;[extends&nbsp;Path\To\Another\Entity\EntityName]&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;field0&nbsp;:&nbsp;Type0&nbsp;[=&nbsp;DEFAULT_0];&nbsp;#&nbsp;Description&nbsp;of&nbsp;field0<br>&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;#&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp;fieldN&nbsp;:&nbsp;TypeN&nbsp;[=&nbsp;DEFAULT_0];&nbsp;#&nbsp;Description&nbsp;of&nbsp;fieldN<br>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;[Indexes&nbsp;:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([-]filedName00,&nbsp;...,&nbsp;[-]fieldName0K)[*];&nbsp;#&nbsp;Description&nbsp;of&nbsp;index&nbsp;number&nbsp;0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;#&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([-]filedNameM0,&nbsp;...,&nbsp;[-]fieldNameML)[*];&nbsp;#&nbsp;Description&nbsp;of&nbsp;index&nbsp;number&nbsp;M<br>&nbsp;&nbsp;&nbsp;&nbsp;}]<br>&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;Validation&nbsp;:&nbsp;{&nbsp;VALIDATION_BODY&nbsp;}&nbsp;]<br>&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;Override&lt;METHOD_NAME_0&gt;&nbsp;{&nbsp;METHOD_0_BODY&nbsp;}&nbsp;]<br>&nbsp;&nbsp;&nbsp;&nbsp;...<br>&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;Override&lt;METHOD_NAME_P&gt;&nbsp;{&nbsp;METHOD_P_BODY&nbsp;}&nbsp;]<br>}<br></code></pre><div class = 'comment'>Note that there is no name for the entity. An entity name is it's file path. Each file can contain at most 1 block and the block name is inherited form the file. It's a good practice to have a comment in first line of file, describing where the file is located.</div><div class = 'comment'><strong>Note:</strong> All entities have a read-only field called <code>id</code>, of type integer, that is defined implicitly. The field <code>id</code> is used in some underlying XUA codes and cannot be removed.</div><div class = 'comment'><a href='#Fields'><h2 class='h2' id='Fields'> Fields</h2></a>
Each entity represents an object class and is used to store properties of an object instance as data in database. The object can have different properties each with their own type and default value. each of these properties is called a field and should be defined with it's type and default value in the fields part.</div><div class = 'comment'><a href='#Indexes'><h2 class='h2' id='Indexes'> Indexes</h2></a>
An index is a list of fields along with a boolean determining if the index is unique. Indexes are used in MySQL engine for faster <code>select</code> queries. A <code>*</code> sign at the end of an index definition makes it a unique index. If the index is marked as unique, the combination of fields must be unique in data. Note that the implicit field <code>id</code> is a unique field by default under.</div><div class = 'comment'><a href='#Validation'><h2 class='h2' id='Validation'> Validation</h2></a>
The body of <code>Validation</code> block is written in pure PHP.</div><div class = 'comment'>The <code>Validation</code> block is responsible to check if an instance of the entity is valid, and in case of invalid data, an <code>EntityValidationException</code> must be thrown. For example assume we have a table of restaurants in an entity called <code>Restaurant</code>. This entity has two fields <code>title</code> and <code>active</code>. The <code>title</code> field is unique but it's not possible to mark it as unique index in <code>Indexes</code>, because we can have many inactive rows sharing a same title, and the title is unique among the active restaurants. We can check this in <code>Validation</code> block and throw a <code>EntityValidationException</code> if the title is duplicate.</div><div class = 'comment'><a href='#Overriding_Methods'><h2 class='h2' id='Overriding_Methods'> Overriding Methods</h2></a>
XUA generates a PHP class from each entity, extending <code>\XUA\Entity</code>. This class have many methods which are possible to override. Here is a list of these methods, with the PHP method that is actually being overridden.</div><pre><code>Override&lt;newInstance&gt;&nbsp;&nbsp;=&gt;&nbsp;protected&nbsp;static&nbsp;newInstance(string&nbsp;$caller);<br>Override&lt;getOne&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;protected&nbsp;static&nbsp;_getOne(string&nbsp;$caller,&nbsp;Condition&nbsp;$condition,&nbsp;Order&nbsp;$order);<br>Override&lt;store&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;protected&nbsp;_store(string&nbsp;$caller);<br>Override&lt;markToDelete&gt;&nbsp;=&gt;&nbsp;protected&nbsp;_markToDelete(string&nbsp;$caller);<br>Override&lt;getMany&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;protected&nbsp;static&nbsp;_getMany(string&nbsp;$caller,&nbsp;Condition&nbsp;$condition,&nbsp;Order&nbsp;$order,&nbsp;Pager&nbsp;$pager);<br>Override&lt;setMany&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;protected&nbsp;static&nbsp;_setMany(string&nbsp;$caller,&nbsp;array&nbsp;$changes,&nbsp;Condition&nbsp;$condition,&nbsp;Order&nbsp;$order,&nbsp;Pager&nbsp;$pager);<br>Override&lt;deleteMany&gt;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;protected&nbsp;static&nbsp;_deleteMany(string&nbsp;$caller,&nbsp;Condition&nbsp;$condition,&nbsp;Order&nbsp;$order,&nbsp;Pager&nbsp;$pager);<br></code></pre><div class = 'comment'>So for example if someone needs to override <code>store</code> procedure, it's possible to add the following code to the body of the entity block.</div><pre><code>Override&lt;store&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(static::fields()[&#x27;updatedAt&#x27;]))<br>&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;updatedAt&nbsp;=&nbsp;DateTimeService::now();<br>&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent::store();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogService::logDatabaseChange($this);<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;as&nbsp;$e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LogService::logDatabaseException($e);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre><div class = 'comment'>Usually the original methods suffice and there is no need to override them, but in case of necessity, be careful not to corrupt the functionality.</div><div class = 'comment'><a href='#Hierarchy'><h2 class='h2' id='Hierarchy'> Hierarchy</h2></a>
Entities can come in a hierarchy just like PHP classes, and the <code>Validation</code> block is a class method.</div><pre><code>protected&nbsp;function&nbsp;_validation();<br></code></pre><div class = 'comment'>Also the fields and indexes of child entity override the ones in parent. This override includes type and default value. Also it's possible to add new fields or indexes to the type, but it's not possible to remove existing fields. Read <a href='#Examples'>Examples</a> for more details.</div><div class = 'comment'><a href='#Visibility'><h2 class='h2' id='Visibility'> Visibility</h2></a>
The visibility of entities is controlled by overriding methods. There is an additional variable accessible in all methods including validation, called <code>$caller</code>. This variable contains an string telling what module called this method. The values are accessible as class constants in class <code>XUA\Tools\Visibility</code>. These values are <code>Visibility::CALLER_PHP</code>,
<code>Visibility::CALLER_DART</code>, etc.</div><div class = 'comment'>So it's possible to block foreign callers like the following.</div><pre><code>if&nbsp;($caller&nbsp;!=&nbsp;Visibility::CALLER_PHP)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this;<br>}<br></code></pre><div class = 'comment'>But there is more than this. It's possible to customize procedures according to the caller. For example</div><pre><code>if&nbsp;($caller&nbsp;!=&nbsp;Visibility::CALLER_PHP)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;id)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!UserService::hasAccess(AccessService::ModifySomeEntity))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!UserService::hasAccess(AccessService::CreateSomeEntity))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br>$this-&gt;updatedByProject&nbsp;=&nbsp;$caller;<br></code></pre><div class = 'comment'><a href='#Helpers'><h1 class='h1' id='Helpers'> Helpers</h1></a></div><div class = 'comment'><a href='#Auto-Generated_Field_Types'><h2 class='h2' id='Auto-Generated_Field_Types'> Auto-Generated Field Types</h2></a>
In addition to defined supers that can be called to generate type for field types, there are some auto-generated supers developers can use.</div><div class = 'comment'><a href='#Relational_Supers'><h3 class='h3' id='Relational_Supers'> Relational Supers</h3></a>
For each entity block that is defined, a relational super is implicitly generated by XUA. This Super has the following signature.</div><pre><code>EntityName&nbsp;(<br>&nbsp;&nbsp;relation&nbsp;:&nbsp;EntityRelationType();<br>&nbsp;&nbsp;cardinalName&nbsp;:&nbsp;Symbol(nullable&nbsp;=&nbsp;true)&nbsp;=&nbsp;null;<br>&nbsp;&nbsp;invName&nbsp;:&nbsp;Symbol(nullable&nbsp;=&nbsp;true)&nbsp;=&nbsp;null;<br>&nbsp;&nbsp;invCardinalName&nbsp;:&nbsp;Symbol(nullable&nbsp;=&nbsp;true)&nbsp;=&nbsp;null;<br>&nbsp;&nbsp;nullable&nbsp;:&nbsp;Boolean()&nbsp;=&nbsp;false;<br>&nbsp;&nbsp;invNullable&nbsp;:&nbsp;Boolean()&nbsp;=&nbsp;false;<br>)<br></code></pre><div class = 'comment'>These Supers create a relation between two entities. The first argument can only have one of the following values, and based on that, there are some limitations for other arguments.
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th style='text-align: left'>Relation</th> <th style='text-align: center'>Title</th> <th style='text-align: left'>Limitations</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td style='text-align: left'><code>XUA\EntityRelation::II</code></td> <td style='text-align: center'>One to One</td> <td style='text-align: left'><code>CardinalName = null; invCardinalName = null;</code></td></tr> <tr><td style='text-align: left'><code>XUA\EntityRelation::IN</code></td> <td style='text-align: center'>One to Many</td> <td style='text-align: left'><code>nullable = false; invCardinalName = null;</code></td></tr> <tr><td style='text-align: left'><code>XUA\EntityRelation::NI</code></td> <td style='text-align: center'>Many to One</td> <td style='text-align: left'><code>CardinalName = null; invnullable = false;</code></td></tr> <tr><td style='text-align: left'><code>XUA\EntityRelation::NN</code></td> <td style='text-align: center'>Many to Many</td> <td style='text-align: left'><code>nullable = false; invnullable = false;</code></td></tr>
                    </tbody>
                </table>
            </div><div class = 'comment'>Let’s say in <code>LeftEntity</code>, there is a filed called <code>relationalField</code> of type <code>RightEntity</code>. The following default values are provided for <code>cardinalName</code>, <code>invName</code>, and <code>invCardinalName</code>, under the mentioned conditions.</div><div class = 'comment'>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th style='text-align: left'>Argument</th> <th style='text-align: left'>Default Value</th> <th style='text-align: left'>Conditions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td style='text-align: left'><code>cardinalName</code></td> <td style='text-align: left'><code>&#x27;relationalField&#x27; + &#x27;Count&#x27;</code></td> <td style='text-align: left'><code>relation == XUA\EntityRelation::IN  or relation == XUA\EntityRelation::NN</code></td></tr> <tr><td style='text-align: left'><code>invName</code></td> <td style='text-align: left'><code>&#x27;inv&#x27; + &#x27;RelationalField&#x27;</code> (Note CamelCasing the <code>relationalField</code>)</td> <td style='text-align: left'>Any conditions</td></tr> <tr><td style='text-align: left'><code>invCardinalName</code></td> <td style='text-align: left'><code>invName + &#x27;Count&#x27;</code></td> <td style='text-align: left'><code>relation == XUA\EntityRelation::NI or relation == XUA\EntityRelation::NN</code></td></tr>
                    </tbody>
                </table>
            </div><div class = 'comment'><a href='#Virtual_Field_Supers'><h3 class='h3' id='Virtual_Field_Supers'> Virtual Field Supers</h3></a></div><div class = 'comment'><a href='#Condition_Class'><h2 class='h2' id='Condition_Class'> Condition Class</h2></a></div><div class = 'comment'><a href='#Order_Class'><h2 class='h2' id='Order_Class'> Order Class</h2></a></div><div class = 'comment'><a href='#Pager_Class'><h2 class='h2' id='Pager_Class'> Pager Class</h2></a></div><div class = 'comment'><a href='#Practicalities'><h1 class='h1' id='Practicalities'> Practicalities</h1></a></div><div class = 'comment'><a href='#Deploy_&_Alters'><h2 class='h2' id='Deploy_&_Alters'> Deploy & Alters</h2></a>
When a new entity is created, or an entity is modified, these changes should be synced with the mysql server. The deploy procedure adds new created entities as tables to the database, and also generates <code>ALTER</code> queries for modified entities. The deploy procedure does not run the alters by itself, instead, it prints out the alters; which are possible to run by the programmer or another person in charge. It's possible to complete the deploy process with the undone alters. This process is called <em>force deploy</em>, and the alters which are possible to ignore while deploying are called <em>force-friendly alters</em>.</div><div class = 'comment'><a href='#Usage'><h1 class='h1' id='Usage'> Usage</h1></a>
It's possible to use a defined entity in both server project (PHP language) and front-end native codes via marshal library, but not in XUA language.</div><div class = 'comment'><a href='#Inside_PHP'><h2 class='h2' id='Inside_PHP'> Inside PHP</h2></a></div><div class = 'comment'><a href='#Make_a_type'><h3 class='h3' id='Make_a_type'> Make a type</h3></a>
The following code makes a type by giving arguments to a super.</div><pre><code>$type&nbsp;=&nbsp;new&nbsp;Path\To\Super\SuperName([<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;argName0&#x27;&nbsp;=&gt;&nbsp;$value0,<br>&nbsp;&nbsp;&nbsp;&nbsp;...,<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;argNameN&#x27;&nbsp;=&gt;&nbsp;$valueN,<br>]);<br></code></pre><div class = 'comment'><a href='#Determine_a_type'><h3 class='h3' id='Determine_a_type'> Determine a type</h3></a>
Assume a type is given in a variable and we need to know what type is it. We can try to find the class of the object but what about arguments? It's almost impossible to get the type accurate unless we have a method for that. The following method returns a string that describes the type.</div><pre><code>var_dump($type-&gt;toString());<br></code></pre><div class = 'comment'>This code dumps <code>&#x27;Path\To\Super\SuperName(argName0 = value0, ..., argNameN = valueN)&#x27;</code>.</div><div class = 'comment'><a href='#Accepts,_Implicit_&_Explicit'><h3 class='h3' id='Accepts,_Implicit_&_Explicit'> Accepts, Implicit & Explicit</h3></a>
There are three <code>accepts</code> functions for a type.</div><div class = 'comment'><a href='#explicitlyAccepts'><h4 class='h4' id='explicitlyAccepts'> explicitlyAccepts</h4></a>
This function will return true only if the value explicitly fits in the type. The second argument is optional, and if the return value is false, the function may fill it with a reason.</div><pre><code>if&nbsp;($type-&gt;explicitlyAccepts($value,&nbsp;$reason))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump($value);<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#x27;is&nbsp;of&nbsp;type&nbsp;&#x27;&nbsp;.&nbsp;$type-&gt;toString();<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#x27;rejected&nbsp;because&nbsp;of&#x27;&nbsp;.&nbsp;$reason;<br>}<br></code></pre><div class = 'comment'><a href='#implicitlyAccepts'><h4 class='h4' id='implicitlyAccepts'> implicitlyAccepts</h4></a>
This function will return true if the value explicitly fits in the type or, fits in the type after unmarshaling. The unmarshaling methods must be determined by caller. The function tries the value itself first, then tries to unmarshal and check if the value fits by given methods, one by one. If not passed to the function, the default value <code>[&#x27;unmarshal&#x27;, &#x27;unmarshalDatabase&#x27;]</code> is assumed.</div><pre><code>if&nbsp;($type-&gt;implicitlyAccepts($value,&nbsp;$reasons,&nbsp;[&#x27;unmarshal&#x27;]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump($value);<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#x27;kinda&nbsp;fits&nbsp;in&nbsp;type&nbsp;&#x27;&nbsp;.&nbsp;$type-&gt;toString();<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#x27;fully&nbsp;rejected&nbsp;because&nbsp;of&nbsp;the&nbsp;following&nbsp;reasons&#x27;;<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump($reasons);<br>}<br></code></pre><div class = 'comment'><a href='#accepts'><h4 class='h4' id='accepts'> accepts</h4></a>
This function does the same job of <code>implicitlyAccepts</code>, but may alter the original value while trying to fit it in the type.</div><pre><code>$originalValue&nbsp;=&nbsp;$value;<br>if&nbsp;($type-&gt;accepts($value,&nbsp;$reasons,&nbsp;[&#x27;unmarshal&#x27;]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump($originalValue);<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#x27;was&nbsp;changed&nbsp;to&#x27;;<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump($value);<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#x27;to&nbsp;fit&nbsp;in&nbsp;type&nbsp;&#x27;&nbsp;.&nbsp;$type-&gt;toString();<br>}&nbsp;else&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#x27;fully&nbsp;rejected&nbsp;because&nbsp;of&nbsp;the&nbsp;following&nbsp;reasons&#x27;;<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump($reasons);<br>}<br></code></pre><div class = 'comment'><a href='#Marshal_&_Unmarshal'><h3 class='h3' id='Marshal_&_Unmarshal'> Marshal & Unmarshal</h3></a>
There are two types of marshal and unmarshal functions available in the server project.</div><div class = 'comment'><a href='#Network_transmissions'><h4 class='h4' id='Network_transmissions'> Network transmissions</h4></a>
Functions <code>marshal</code> and <code>unmarshal</code> are responsible to marshal and unmarshal values for purpose of network transmissions.</div><pre><code>$marshaledValue&nbsp;=&nbsp;$type-&gt;marshal($value);<br>$reversedValue&nbsp;=&nbsp;$type-&gt;unmarshal($marshaledValue);<br>if&nbsp;($value&nbsp;!==&nbsp;$reversedValue)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump(&#x27;something&nbsp;is&nbsp;wrong&nbsp;with&nbsp;marshal/unmarshal&nbsp;functions&nbsp;of&nbsp;&#x27;&nbsp;.&nbsp;$type-&gt;toString());<br>}<br></code></pre><div class = 'comment'><a href='#Database_Storing_&_Restoring'><h4 class='h4' id='Database_Storing_&_Restoring'> Database Storing & Restoring</h4></a>
Functions <code>marshalDatabase</code> and <code>unmarshalDatabase</code> are responsible to marshal and unmarshal values for purpose of storing and restoring into/from database.</div><pre><code>$marshaledValue&nbsp;=&nbsp;$type-&gt;marshalDatabase($value);<br>$reversedValue&nbsp;=&nbsp;$type-&gt;unmarshalDatabase($marshaledValue);<br>if&nbsp;($value&nbsp;!==&nbsp;$reversedValue)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;var_dump(&#x27;something&nbsp;is&nbsp;wrong&nbsp;with&nbsp;marshalDatabase/unmarshalDatabase&nbsp;functions&nbsp;of&nbsp;&#x27;&nbsp;.&nbsp;$type-&gt;toString());<br>}<br></code></pre><div class = 'comment'><a href='#Database_Type'><h3 class='h3' id='Database_Type'> Database Type</h3></a>
The function <code>DatabaseType</code> is a function with no arguments that returns an string which tells the database how the type values must be stored. And is hardly useful in programming.</div><div class = 'comment'><a href='#Inside_XUA'><h2 class='h2' id='Inside_XUA'> Inside XUA</h2></a>
The main usage of supers is to declare types for XUA super arguments, entity fields, and method request and response signatures. To mention a type, one must call a super and give it arguments. The type then, can be used for type declaration. The syntax is the following.</div><pre><code>Path\To\Super\SuperName(<br>&nbsp;&nbsp;&nbsp;&nbsp;argName0&nbsp;=&nbsp;constant0,<br>&nbsp;&nbsp;&nbsp;&nbsp;...,<br>&nbsp;&nbsp;&nbsp;&nbsp;argNameN&nbsp;=&nbsp;constantN,<br>)<br></code></pre><div class = 'comment'><a href='#Examples'><h1 class='h1' id='Examples'> Examples</h1></a></div><div class = 'comment'><a href='#Range'><h2 class='h2' id='Range'> Range</h2></a>
In this section, we want to work with a super type that accepts a range of integers $[a, b)$.</div><div class = 'comment'><a href='#Definition'><h3 class='h3' id='Definition'> Definition</h3></a>
First of all, we need to define the super. we put it in the file <code>Supers/Integers/Range.xua</code>.</div><div class = 'comment'><a href='#Arguments'><h4 class='h4' id='Arguments'> Arguments</h4></a>
We need to have two arguments determining start and end of the range. The arguments must be integer themselves.</div><pre><code>#&nbsp;Supers\Integers\Range<br>Super&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;:&nbsp;Supers\Integers\Integer();<br>&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;&nbsp;&nbsp;:&nbsp;Supers\Integers\Integer();<br>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;TODO&nbsp;implement<br>}<br></code></pre><div class = 'comment'><a href='#Validation'><h4 class='h4' id='Validation'> Validation</h4></a>
For the validation, we must check that the second number is not less than the first one. Note that we do not need to check if the type of arguments is integer since we already declared their type so the type checking is automated.</div><pre><code>Validation&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;args[&#x27;end&#x27;]&nbsp;&lt;&nbsp;$this-&gt;args[&#x27;start&#x27;])&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;SuperValidationException(&#x27;Argument&nbsp;end&nbsp;cannot&nbsp;be&nbsp;less&nbsp;than&nbsp;start.&#x27;);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre><div class = 'comment'><a href='#Predicate'><h4 class='h4' id='Predicate'> Predicate</h4></a>
We can just simply check if the <code>$input</code> value is in the range.</div><pre><code>Predicate&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;args[&#x27;start&#x27;]&nbsp;&lt;=&nbsp;$input&nbsp;&amp;&amp;&nbsp;$input&nbsp;&lt;&nbsp;$this-&gt;args[&#x27;end&#x27;];<br>}<br></code></pre><div class = 'comment'>But we can make it a little more sophisticated by providing a reason of why the value may fail to fit.</div><pre><code>Predicate&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!($this-&gt;args[&#x27;start&#x27;]&nbsp;&lt;=&nbsp;$input))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;$input&nbsp;.&nbsp;&#x27;&nbsp;is&nbsp;less&nbsp;than&nbsp;&#x27;&nbsp;.&nbsp;$this-&gt;args[&#x27;start&#x27;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!($input&nbsp;&lt;&nbsp;$this-&gt;args[&#x27;end&#x27;]))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;$input&nbsp;.&nbsp;&#x27;&nbsp;is&nbsp;not&nbsp;less&nbsp;than&nbsp;&#x27;&nbsp;.&nbsp;$this-&gt;args[&#x27;end&#x27;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br>}<br></code></pre><div class = 'comment'>Note that it's OK to fill the $reason when the return value is <code>true</code>. XUA automatically clears the <code>$message</code> in that case.</div><div class = 'comment'><a href='#Marshal_and_Unmarshal'><h4 class='h4' id='Marshal_and_Unmarshal'> Marshal and Unmarshal</h4></a>
Since the integers are possible to store and transmit, we can leave the marshal and unmarshal functions identity. But for the purpose of this documentation, we define a network transmit marshaling system, and leave the database store marshaling identity.</div><div class = 'comment'>The silly idea is to shift starting number to zero to have smaller integers which are easier to transmit (it's not). For example The range $[1000, 1100)$ can be shifted to $[0, 100)$.</div><pre><code>Marshal&lt;php&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input&nbsp;-&nbsp;$this-&gt;args[&#x27;start&#x27;];<br>}<br>Unmarshal&lt;php&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input&nbsp;+&nbsp;$this-&gt;args[&#x27;start&#x27;];<br>}<br>Marshal&lt;javascript&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;input&nbsp;-&nbsp;this.args.start;<br>}<br>Unmarshal&lt;javascript&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;input&nbsp;+&nbsp;this.args.start;<br>}<br></code></pre><div class = 'comment'><a href='#Database_Type'><h4 class='h4' id='Database_Type'> Database Type</h4></a>
This is an interesting part of the definition, since we can actually determine the length of MySQL <code>INT</code> by the range limits.</div><div class = 'comment'>We know that <code>INT(n)</code> can store values in range $[-2^{n-1}, 2^{n-1}]$. So we need to find the least $n$ such that this range contains our range. First, we find the maximum absolute value that can fit in the type.</div><pre><code>$min&nbsp;=&nbsp;$this-&gt;args[&#x27;start&#x27;];<br>$max&nbsp;=&nbsp;$this-&gt;args[&#x27;end&#x27;]&nbsp;-&nbsp;1;<br>$absMax&nbsp;=&nbsp;max(abs($min),&nbsp;abs($max));<br></code></pre><div class = 'comment'>Let's say this number is $M$. we must find $n$ such that $M \leq 2^{n-1}$.
$$\begin{eqnarray}
M \leq 2^{n-1} & \iff & \log_2(M) \leq n - 1 \\
(\text{Since $n - 1$ is integer}) & \iff & \lceil \log_2(M) \rceil \leq n - 1 \\
& \iff & \lceil \log_2(M) \rceil + 1 \leq n \\
\end{eqnarray}$$</div><div class = 'comment'>Do the minimum value of $n$ is when $n = \lceil \log_2(M) \rceil + 1$.</div><pre><code>$n&nbsp;=&nbsp;ceil(log($absMax,&nbsp;2))&nbsp;+&nbsp;1;<br></code></pre><div class = 'comment'>This leads us to the following <code>DatabaseType</code>.</div><pre><code>DatabaseType&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;$min&nbsp;=&nbsp;$this-&gt;args[&#x27;start&#x27;];<br>&nbsp;&nbsp;&nbsp;&nbsp;$max&nbsp;=&nbsp;$this-&gt;args[&#x27;end&#x27;]&nbsp;-&nbsp;1;<br>&nbsp;&nbsp;&nbsp;&nbsp;$absMax&nbsp;=&nbsp;max(abs($min),&nbsp;abs($max));<br>&nbsp;&nbsp;&nbsp;&nbsp;$n&nbsp;=&nbsp;ceil(log($absMax,&nbsp;2))&nbsp;+&nbsp;1;<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;INT($n)&quot;;<br>}<br></code></pre><div class = 'comment'><a href='#Hierarchy'><h4 class='h4' id='Hierarchy'> Hierarchy</h4></a>
Assume that we want another super with same features, but only for positive values. We can just extend what we already have.</div><pre><code>#&nbsp;Supers\Integers\PositiveRange<br>Super&nbsp;extends&nbsp;Supers\Integers\Range&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;Validation&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;args[&#x27;start]&nbsp;&lt;=&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;SuperValidationException(&#x27;The&nbsp;range&nbsp;must&nbsp;be&nbsp;positive&#x27;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent::validation();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre><div class = 'comment'>Or assume we want a range super that can only start at zero.</div><pre><code>#&nbsp;Supers\Integers\NaturalUpperLimit<br>Super&nbsp;extends&nbsp;Supers\Integers\Range&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;start&nbsp;:&nbsp;Supers\Integers\Integer()&nbsp;=&nbsp;0;<br>)&nbsp;{}<br></code></pre><div class = 'comment'>Note the way we overrode the <code>start</code> with default value, but also set it constant so the caller cannot change it.</div><pre><code>$type&nbsp;=&nbsp;new&nbsp;Supers\Integers\NaturalUpperLimit([&#x27;start&#x27;&nbsp;=&gt;&nbsp;1,&nbsp;&#x27;end&#x27;&nbsp;=&gt;&nbsp;2]);<br></code></pre><div class = 'comment'>This code will result in uncaught <code>SuperValidationException</code>.</div><div class = 'comment'>But better than these, assume we use the network transmit marshaling procedures for database which can really make an impact. And also remove the silly network transmit marshaling procedure. But we must override the <code>DatabaseType</code> as well.</div><pre><code>#&nbsp;Supers\Integers\EfficientRange<br>Super&nbsp;extends&nbsp;Supers\Integers\Range&nbsp;()&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;Marshal&lt;php&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;Unmarshal&lt;php&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;Marshal&lt;javascript&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;Unmarshal&lt;javascript&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;Marshal&lt;database&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input&nbsp;-&nbsp;$this-&gt;args[&#x27;start&#x27;];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;Unmarshal&lt;database&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$input&nbsp;+&nbsp;$this-&gt;args[&#x27;start&#x27;];<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;DatabaseType&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$max&nbsp;=&nbsp;$this-&gt;args[&#x27;end&#x27;]&nbsp;-&nbsp;$this-&gt;args[&#x27;start&#x27;]&nbsp;-&nbsp;1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$n&nbsp;=&nbsp;ceil(log($max,&nbsp;2))&nbsp;+&nbsp;1;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;INT($n)&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre><div class = 'comment'>Another example is when we want to add arguments to a super. For example assume we want an <code>step</code> argument. By default the step is one. but if we set step to three, then the type accepts <code>start</code> and every third number.</div><pre><code>#&nbsp;Supers\Integers\StepRange<br>Super&nbsp;extends&nbsp;Supers\Integers\Range&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;step&nbsp;:&nbsp;Supers\Integers\Integer()&nbsp;=&nbsp;1;<br>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;Validation&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent::validation();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(step&nbsp;&lt;&nbsp;1)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;SuperValidationException(&#x27;step&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;1.&#x27;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;Predicate&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!parent::predicate($input,&nbsp;$message))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($input&nbsp;-&nbsp;$this-&gt;argument[&#x27;start&#x27;]&nbsp;%&nbsp;$this-&gt;argument[&#x27;step&#x27;]&nbsp;!=&nbsp;0)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;&quot;value&nbsp;{$input}&nbsp;minus&nbsp;starting&nbsp;point&nbsp;{$this-&gt;argument[&#x27;start&#x27;]}&nbsp;is&nbsp;not&nbsp;devisable&nbsp;by&nbsp;step&nbsp;value&nbsp;{$this-&gt;argument[&#x27;step&#x27;]}.&quot;;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre><div class = 'comment'><a href='#Usage'><h3 class='h3' id='Usage'> Usage</h3></a>
After defining a super, we can use it to define types, and use them.</div><div class = 'comment'><a href='#Inside_PHP'><h4 class='h4' id='Inside_PHP'> Inside PHP</h4></a>
First, Let's define a type that accepts the range $[10, 30)$. We use the <code>EfficientRange</code>.</div><pre><code>$type&nbsp;=&nbsp;new&nbsp;Supers\Integers\EfficientRange([&#x27;start&#x27;&nbsp;=&gt;&nbsp;10,&nbsp;&#x27;end&#x27;&nbsp;=&gt;&nbsp;30]);<br></code></pre><div class = 'comment'>Let's see what how XUA stringifies this type.</div><pre><code>var_dump($type-&gt;toString());<br></code></pre><div class = 'comment'>This code dumps <code>Supers\Integers\EfficientRange(start = 10, end = 30)</code>.</div><div class = 'comment'>The value <code>25</code> explicitly fits in the type, while the value <code>5</code> implicitly fits.</div><pre><code>$value&nbsp;=&nbsp;25;<br>var_dump($type-&gt;explicitlyAccepts($value));&nbsp;#&nbsp;dumps&nbsp;true<br>$value&nbsp;=&nbsp;5;<br>var_dump($type-&gt;implicitlyAccepts($value));&nbsp;#&nbsp;dumps&nbsp;true<br></code></pre><div class = 'comment'>Of course the value <code>25</code> also fits in the type implicitly. This is because the function first checks if the value explicitly fits.</div><pre><code>$value&nbsp;=&nbsp;25;<br>var_dump($type-&gt;implicitlyAccepts($value));&nbsp;#&nbsp;dumps&nbsp;true<br></code></pre><div class = 'comment'>We know value <code>15</code> is ambiguous. It can be interpreted as <code>15</code> itself, a value in range, or the result of marshaling <code>25</code>. Let's call accept and check the result.</div><pre><code>$value&nbsp;=&nbsp;15;<br>var_dump($type-&gt;accepts($value));&nbsp;#&nbsp;dumps&nbsp;true<br>var_dump($value);&nbsp;#&nbsp;dumps&nbsp;15<br></code></pre><div class = 'comment'>Since the function first tries the explicit, if the value fits explicitly, function doesn't change the value. What about <code>5</code> that can only fit implicitly?</div><pre><code>$value&nbsp;=&nbsp;5;<br>var_dump($type-&gt;accepts($value));&nbsp;#&nbsp;dumps&nbsp;true<br>var_dump($value);&nbsp;#&nbsp;dumps&nbsp;15<br></code></pre><div class = 'comment'>This time the function tries to fit the value explicitly and fails, so it goes for unamrshaling, which leads to accept.</div><div class = 'comment'>We know the value $5$ doesn't fit explicitly, but we may wonder why. (It's super obvious but is a good way to see how to get the reason from the function.)</div><pre><code>$value&nbsp;=&nbsp;5;<br>var_dump($type-&gt;explicitlyAccepts($value,&nbsp;$reason));&nbsp;#&nbsp;dumps&nbsp;false<br>var_dump($reason);&nbsp;#&nbsp;dumps&nbsp;&#x27;5&nbsp;is&nbsp;less&nbsp;than&nbsp;10&#x27;<br></code></pre><div class = 'comment'>What about value <code>30</code>?</div><pre><code>$value&nbsp;=&nbsp;30;<br>var_dump($type-&gt;explicitlyAccepts($value,&nbsp;$reason));&nbsp;#&nbsp;dumps&nbsp;false<br>var_dump($reason);&nbsp;#&nbsp;dumps&nbsp;&#x27;30&nbsp;is&nbsp;not&nbsp;less&nbsp;than&nbsp;30&#x27;<br></code></pre><div class = 'comment'>But we know <code>30</code> doesn't even implicitly fit.</div><pre><code>$value&nbsp;=&nbsp;30;<br>var_dump($type-&gt;accepts($value,&nbsp;$reasons));&nbsp;#&nbsp;dumps&nbsp;false<br>var_dump($reasons);<br></code></pre><div class = 'comment'>This function fills the <code>$reasons</code> with an array, reasoning about each failure.</div><pre><code>[<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;identity&#x27;&nbsp;=&gt;&nbsp;&#x27;30&nbsp;is&nbsp;not&nbsp;less&nbsp;than&nbsp;30&#x27;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;unmarshal&#x27;&nbsp;=&gt;&nbsp;&#x27;30&nbsp;is&nbsp;not&nbsp;less&nbsp;than&nbsp;30&#x27;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;unmarshalDatabase&#x27;&nbsp;=&gt;&nbsp;&#x27;40&nbsp;is&nbsp;not&nbsp;less&nbsp;than&nbsp;30&#x27;,<br>]<br></code></pre><div class = 'comment'>The <code>$reason</code> variable can work like a log, for example we try the code above with <code>5</code>, and get the following.</div><pre><code>[<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;identity&#x27;&nbsp;=&gt;&nbsp;&#x27;5&nbsp;is&nbsp;less&nbsp;than&nbsp;10&#x27;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;unmarshal&#x27;&nbsp;=&gt;&nbsp;&#x27;5&nbsp;is&nbsp;less&nbsp;than&nbsp;10&#x27;,<br>&nbsp;&nbsp;&nbsp;&nbsp;&#x27;unmarshalDatabase&#x27;&nbsp;=&gt;&nbsp;null,<br>]<br></code></pre><div class = 'comment'>We can see there is no reason for the <code>unmarshalDatabase</code>, and it makes sense since the value fitted.</div><div class = 'comment'>We know that the storing in the database is done by marshalling. The marshaled values are in $[0, 20)$.</div><pre><code>var_dump($type-&gt;DatabaseType());&nbsp;#&nbsp;Dumps&nbsp;&#x27;INT(6)&#x27;<br></code></pre><div class = 'comment'>In this case there is no efficiency since the original values would only need <code>6</code> bits to. Although we could make this better if we shifted the center of the range to zero instead of starting point. That way we would have range $[-10, 10)$ which needs only $5$ bits ro store. Any way none of this is useful because MySQL occupies at least a byte which is <code>8</code> bits. And there is no difference between <code>5</code> and <code>6</code> in practice. Although this method of marshaling may come handy for big values, XUA's official <code>Range</code> does not use it because of the ambiguity.</div><div class = 'comment'><a href='#Inside_XUA'><h4 class='h4' id='Inside_XUA'> Inside XUA</h4></a>
We may use a super to define another super.</div><pre><code>#&nbsp;Supers\Gender<br>Super&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;possibilities&nbsp;:&nbsp;Supers\Integers\Range(start&nbsp;=&nbsp;2,&nbsp;end&nbsp;=&nbsp;4)&nbsp;=&nbsp;2;<br>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;Predicate&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$choices&nbsp;=&nbsp;[&#x27;male&#x27;,&nbsp;&#x27;female&#x27;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;args[&#x27;possibilities&#x27;]&nbsp;==&nbsp;3)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$choices&nbsp;=&nbsp;[&#x27;male&#x27;,&nbsp;&#x27;female&#x27;,&nbsp;&#x27;third&#x27;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$message&nbsp;=&nbsp;&#x27;$input&nbsp;is&nbsp;not&nbsp;in&nbsp;&#x27;&nbsp;.&nbsp;implode(&quot;,&nbsp;&quot;,&nbsp;$choices);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;in_array($input,&nbsp;$choices);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br></code></pre><div class = 'comment'>Note how we set the <code>$message</code> without caring about the return value. XUA automatically clears the <code>$message</code> if the return value is <code>true</code>.</div><div class = 'comment'><a href='#Good_News'><h1 class='h1' id='Good_News'> Good News</h1></a>
Although defining a simple super seems easy, defining a complete super with all features in many languages, seems exhausting. The good news is, XUA provides a set of predefined supers that cover almost any need. We discuss them in the next chapter.</div>

        </div>

        <div id="footer">
            This page has been generated by <a href="http://xuarazmi.ir/">xua</a>
        </div>

    </div>

</body>

</html>